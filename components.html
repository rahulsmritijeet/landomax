<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Components - ATL Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Loader -->
    <div id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üî¨</div>
                ATL Dashboard
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="projects.html" class="nav-link">Projects</a>
                <a href="components.html" class="nav-link active">Components</a>
                <a href="competitions.html" class="nav-link">Competitions</a>
                <a href="orders.html" class="nav-link">Orders</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="page-header">
            <h1 class="page-title">‚öôÔ∏è Components</h1>
            <div class="btn-group">
                <button class="btn btn-success" onclick="openExcelUploadModal()">
                    <span>üìä</span> Import Excel
                </button>
                <a href="component_form.html" class="btn btn-primary">
                    <span>‚ûï</span> Add Component
                </a>
            </div>
        </div>

        <!-- Excel Upload Section -->
        <div class="card upload-card" id="uploadCard" style="display: none;">
            <div class="card-header">
                <h3 class="card-title">üìä Import Components from Excel</h3>
                <button class="btn btn-sm btn-secondary" onclick="closeExcelUpload()">‚úï Close</button>
            </div>
            
            <div class="upload-section">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üìÅ</div>
                    <h4>Drop Excel file here or click to browse</h4>
                    <p>Supports .xlsx, .xls, .csv files</p>
                    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="handleExcelUpload(event)" hidden>
                    <button class="btn btn-primary" onclick="document.getElementById('excelFile').click()">
                        Choose File
                    </button>
                </div>
                
                <div class="ai-info">
                    <h4>ü§ñ AI-Powered Auto-Detection</h4>
                    <p>Our smart parser will automatically detect and map columns like:</p>
                    <ul>
                        <li><strong>Name/Component Name/Item</strong> ‚Üí Component Name</li>
                        <li><strong>Type/Category/Kind</strong> ‚Üí Type</li>
                        <li><strong>Description/Details/Info</strong> ‚Üí Description</li>
                        <li><strong>Qty/Quantity/Count/Stock</strong> ‚Üí Quantity</li>
                    </ul>
                </div>
            </div>
            
            <!-- Preview Section -->
            <div id="previewSection" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">üìã Preview Import Data</h3>
                    <span class="badge" id="rowCount">0 rows</span>
                </div>
                
                <!-- Column Mapping -->
                <div class="mapping-section">
                    <h4>üîó Column Mapping (AI Suggested)</h4>
                    <p class="mapping-info">Adjust mappings if needed:</p>
                    <div class="mapping-grid" id="mappingGrid"></div>
                </div>
                
                <!-- Data Preview Table -->
                <div class="table-container preview-table">
                    <table>
                        <thead id="previewHead"></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-success" onclick="importComponents()">
                        <span>‚úÖ</span> Import <span id="importCount">0</span> Components
                    </button>
                    <button class="btn btn-secondary" onclick="clearPreview()">
                        <span>üîÑ</span> Clear & Try Again
                    </button>
                </div>
            </div>
        </div>

        <!-- Components Table -->
        <div class="card">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Component ID</th>
                            <th>Component Name</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="componentsTableBody">
                        <tr>
                            <td colspan="6" class="no-data">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Quantity Modal -->
    <div class="modal" id="quantityModal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>üì¶ Update Quantity</h3>
                <button class="modal-close" onclick="closeQuantityModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p id="quantityComponentName" class="quantity-component-name"></p>
                <div class="quantity-controls">
                    <button class="btn btn-secondary quantity-btn" onclick="adjustQuantity(-10)">-10</button>
                    <button class="btn btn-secondary quantity-btn" onclick="adjustQuantity(-1)">-1</button>
                    <input type="number" id="quantityInput" class="quantity-input" min="0" value="0">
                    <button class="btn btn-secondary quantity-btn" onclick="adjustQuantity(1)">+1</button>
                    <button class="btn btn-secondary quantity-btn" onclick="adjustQuantity(10)">+10</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveQuantity()">Save</button>
                <button class="btn btn-secondary" onclick="closeQuantityModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', loadComponents);
        
        // Drag and drop functionality
        const uploadZone = document.getElementById('uploadZone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleExcelFile(files[0]);
            }
        });
    </script>
</body>
</html>
